# DB スキーマ定義

## DB 一覧

| DB | Database ID | Data Source ID | 用途 |
|----|-------------|----------------|------|
| StorageDB | `49998bb8988d44b083e816f939d9d018` | `48887d97-0f04-4c52-9f44-0b77fd8cf4f1` | 情報収集・分析・ナレッジ管理の統合DB |
| TagMasterDB | `029d37fc76a94eda8b55560495cd6e3f` | `bff41912-a14a-486a-a42e-d0de9a734f34` | タグ・カテゴリのマスター管理 |

---

## StorageDB スキーマ

### ページボディ（本文ブロック）

Notionページの本文（コンテンツブロック）に元のテキスト内容が格納される場合がある。
`notion-fetch` でページを取得すると、プロパティに加えて本文ブロックも返される。
**Phase 2 のコンテンツ取得では、RawContent プロパティより前にページボディを優先して確認すること。**

### 基本プロパティ（収集時に設定）

| プロパティ | 型 | 説明 |
|-----------|-----|------|
| Title | title | 記事タイトル |
| SourceURL | url | 元記事のURL |
| SourceType | select | `テキスト`, `Web記事`, `YouTube`, `PDF` |
| Status | select | `null`(未処理), `処理中`, `完了`, `エラー` |
| RawContent | rich_text | 元のテキスト内容（ページボディが空の場合の代替） |
| Files | files | 添付ファイル |

### 分析プロパティ（エージェントが処理時に設定）

| プロパティ | 型 | 選択肢 |
|-----------|-----|--------|
| Category | select | `AI・機械学習`, `半導体・ハードウェア`, `クラウド・インフラ`, `エネルギー・環境`, `経済・マクロ`, `産業・ビジネス`, `規制・政策` |
| SubCategory | multi_select | `LLM`, `RAG`, `Agent`, `MLOps`, `GPU`, `CPU`, `決算`, `M&A`, `Computer Vision`, `NLP`, `音声認識`, `メモリ`, `製造プロセス`, `EDA`, `パッケージング`, `IaaS`, `PaaS`, `サーバーレス`, `コンテナ`, `ネットワーク`, `再生可能エネルギー`, `原子力`, `電力需給`, `ESG`, `金融政策`, `為替`, `金利`, `GDP`, `インフレ`, `IPO`, `事業戦略`, `組織変革`, `AI規制`, `データ保護`, `輸出規制`, `補助金` |
| Tags | multi_select | `決算資料`, `プレスリリース`, `政府資料`, `日本`, `米国`, `上場企業`, `調査レポート`, `技術解説`, `インタビュー`, `中国`, `欧州`, `非上場`, `スタートアップ`, `要フォロー`, `要深掘り` |
| Companies | multi_select | 任意（新規追加可） |
| Relevance | select | `高`, `中`, `低` |
| Summary | rich_text | 構造化要約 |
| KeyPoints | rich_text | 要点の箇条書き |
| OriginalDate | date | 元記事の公開日 |

### システムプロパティ（エージェントが処理時に設定）

| プロパティ | 型 | 説明 |
|-----------|-----|------|
| ProcessedAt | date | 処理完了日時 |
| ErrorLog | rich_text | エラー発生時のログ |

### Status フロー
```
null(未処理) → 処理中 → 完了
                    ↘ エラー
```

### Summary のフォーマット
```
[概要] 一文で記事の主旨を説明。
[主要内容] 記事の核心的な内容を2-3文で説明。
[意義・影響] ビジネスパーソンにとっての意義や影響を1-2文で説明。
```

### KeyPoints のフォーマット
```
• ポイント1の見出し: 詳細説明（1-2文）
• ポイント2の見出し: 詳細説明（1-2文）
• ポイント3の見出し: 詳細説明（1-2文）
• ポイント4の見出し: 詳細説明（1-2文）
```

---

## TagMasterDB スキーマ

カテゴリ、サブカテゴリ、タグの正規化リストを管理。
新しいタグを作成する前に、既存のタグと重複がないか確認すること。
